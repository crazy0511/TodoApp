{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport { Filter } from '../models/filter.model';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./local-storage.service\";\nexport class TodoService {\n  constructor(storageService) {\n    this.storageService = storageService;\n    this.lengthSubject = new BehaviorSubject(0);\n    this.displayTodosSubject = new BehaviorSubject([]);\n    this.currentFilter = Filter.All;\n    this.todo$ = this.displayTodosSubject.asObservable();\n    this.length$ = this.lengthSubject.asObservable();\n  }\n  fetchFromLocalStorage() {\n    this.todos = this.storageService.getValue(TodoService.TodoStorageKey) || [];\n    this.filterTodos = [...this.todos.map(todo => ({\n      ...todo\n    }))];\n    this.updateTodosData();\n  }\n  updateToLocalStorage() {\n    this.storageService.setObject(TodoService.TodoStorageKey, this.todos);\n    this.filterTodo(this.currentFilter, false);\n    this.updateTodosData();\n  }\n  filterTodo(filter, isFiltering = true) {\n    this.currentFilter = filter;\n    switch (filter) {\n      // Với todo.isCompleted = fasle\n      case Filter.Active:\n        this.filterTodos = this.todos.filter(todo => !todo.isCompleted);\n        break;\n      // Với todo.isCompleted = true\n      case Filter.Completed:\n        this.filterTodos = this.todos.filter(todo => todo.isCompleted);\n        break;\n      // Với tất cả các todo\n      case Filter.All:\n        this.filterTodos = [...this.todos.map(todo => ({\n          ...todo\n        }))];\n        break;\n    }\n    if (isFiltering) {\n      this.updateTodosData();\n    }\n  }\n  updateTodosData() {\n    this.displayTodosSubject.next(this.filterTodos);\n    this.lengthSubject.next(this.todos.length);\n  }\n}\nTodoService.TodoStorageKey = \"todos\";\nTodoService.ɵfac = function TodoService_Factory(t) {\n  return new (t || TodoService)(i0.ɵɵinject(i1.LocalStorageService));\n};\nTodoService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: TodoService,\n  factory: TodoService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"names":["BehaviorSubject","Filter","TodoService","constructor","storageService","lengthSubject","displayTodosSubject","currentFilter","All","todo$","asObservable","length$","fetchFromLocalStorage","todos","getValue","TodoStorageKey","filterTodos","map","todo","updateTodosData","updateToLocalStorage","setObject","filterTodo","filter","isFiltering","Active","isCompleted","Completed","next","length","i0","ɵɵinject","i1","LocalStorageService","factory","ɵfac","providedIn"],"sources":["D:\\Data\\TTS_Angular\\ToDoApp\\angular_todoapp\\src\\app\\services\\todo.service.ts"],"sourcesContent":["import { Injectable, OnInit } from '@angular/core';\nimport { Todo } from '../models/todo.model';\nimport { BehaviorSubject, Observable, ObservableLike } from 'rxjs';\nimport { Filter } from '../models/filter.model';\nimport { LocalStorageService } from './local-storage.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class TodoService{\n\n  private static readonly TodoStorageKey = \"todos\";\n\n  private todos!: Todo[];\n  private filterTodos!: Todo[];\n  private lengthSubject: BehaviorSubject<number> = new BehaviorSubject<number>(0);\n  private displayTodosSubject: BehaviorSubject<Todo[]> = new BehaviorSubject<Todo[]>([]);\n  private currentFilter: Filter = Filter.All;\n\n  todo$: Observable<Todo[]> = this.displayTodosSubject.asObservable();\n  length$: Observable<number> = this.lengthSubject.asObservable();\n\n  constructor(private storageService: LocalStorageService) {  }\n\n  fetchFromLocalStorage(){\n    this.todos = this.storageService.getValue<Todo[]>(TodoService.TodoStorageKey) || [];\n    this.filterTodos = [...this.todos.map(todo => ({...todo}) )];\n    this.updateTodosData();\n  }\n\n  updateToLocalStorage(){\n    this.storageService.setObject(TodoService.TodoStorageKey, this.todos);\n    this.filterTodo(this.currentFilter, false);\n    this.updateTodosData();\n  }\n\n  filterTodo(filter: Filter, isFiltering: boolean = true){\n    this.currentFilter = filter;\n    switch(filter){\n      // Với todo.isCompleted = fasle\n      case Filter.Active:\n        this.filterTodos = this.todos.filter(todo => !todo.isCompleted);\n        break;\n      // Với todo.isCompleted = true\n      case Filter.Completed:\n        this.filterTodos = this.todos.filter(todo => todo.isCompleted);\n        break;\n      // Với tất cả các todo\n      case Filter.All:\n        this.filterTodos = [...this.todos.map(todo => ({...todo}) )];\n        break;\n    }\n\n    if(isFiltering){\n      this.updateTodosData();\n    }\n  }\n\n  private updateTodosData(){\n    this.displayTodosSubject.next(this.filterTodos);\n    this.lengthSubject.next(this.todos.length);\n  }\n}\n"],"mappings":"AAEA,SAASA,eAAe,QAAoC,MAAM;AAClE,SAASC,MAAM,QAAQ,wBAAwB;;;AAM/C,OAAM,MAAOC,WAAW;EAatBC,YAAoBC,cAAmC;IAAnC,KAAAA,cAAc,GAAdA,cAAc;IAP1B,KAAAC,aAAa,GAA4B,IAAIL,eAAe,CAAS,CAAC,CAAC;IACvE,KAAAM,mBAAmB,GAA4B,IAAIN,eAAe,CAAS,EAAE,CAAC;IAC9E,KAAAO,aAAa,GAAWN,MAAM,CAACO,GAAG;IAE1C,KAAAC,KAAK,GAAuB,IAAI,CAACH,mBAAmB,CAACI,YAAY,EAAE;IACnE,KAAAC,OAAO,GAAuB,IAAI,CAACN,aAAa,CAACK,YAAY,EAAE;EAEH;EAE5DE,qBAAqBA,CAAA;IACnB,IAAI,CAACC,KAAK,GAAG,IAAI,CAACT,cAAc,CAACU,QAAQ,CAASZ,WAAW,CAACa,cAAc,CAAC,IAAI,EAAE;IACnF,IAAI,CAACC,WAAW,GAAG,CAAC,GAAG,IAAI,CAACH,KAAK,CAACI,GAAG,CAACC,IAAI,KAAK;MAAC,GAAGA;IAAI,CAAC,CAAC,CAAE,CAAC;IAC5D,IAAI,CAACC,eAAe,EAAE;EACxB;EAEAC,oBAAoBA,CAAA;IAClB,IAAI,CAAChB,cAAc,CAACiB,SAAS,CAACnB,WAAW,CAACa,cAAc,EAAE,IAAI,CAACF,KAAK,CAAC;IACrE,IAAI,CAACS,UAAU,CAAC,IAAI,CAACf,aAAa,EAAE,KAAK,CAAC;IAC1C,IAAI,CAACY,eAAe,EAAE;EACxB;EAEAG,UAAUA,CAACC,MAAc,EAAEC,WAAA,GAAuB,IAAI;IACpD,IAAI,CAACjB,aAAa,GAAGgB,MAAM;IAC3B,QAAOA,MAAM;MACX;MACA,KAAKtB,MAAM,CAACwB,MAAM;QAChB,IAAI,CAACT,WAAW,GAAG,IAAI,CAACH,KAAK,CAACU,MAAM,CAACL,IAAI,IAAI,CAACA,IAAI,CAACQ,WAAW,CAAC;QAC/D;MACF;MACA,KAAKzB,MAAM,CAAC0B,SAAS;QACnB,IAAI,CAACX,WAAW,GAAG,IAAI,CAACH,KAAK,CAACU,MAAM,CAACL,IAAI,IAAIA,IAAI,CAACQ,WAAW,CAAC;QAC9D;MACF;MACA,KAAKzB,MAAM,CAACO,GAAG;QACb,IAAI,CAACQ,WAAW,GAAG,CAAC,GAAG,IAAI,CAACH,KAAK,CAACI,GAAG,CAACC,IAAI,KAAK;UAAC,GAAGA;QAAI,CAAC,CAAC,CAAE,CAAC;QAC5D;;IAGJ,IAAGM,WAAW,EAAC;MACb,IAAI,CAACL,eAAe,EAAE;;EAE1B;EAEQA,eAAeA,CAAA;IACrB,IAAI,CAACb,mBAAmB,CAACsB,IAAI,CAAC,IAAI,CAACZ,WAAW,CAAC;IAC/C,IAAI,CAACX,aAAa,CAACuB,IAAI,CAAC,IAAI,CAACf,KAAK,CAACgB,MAAM,CAAC;EAC5C;;AApDW3B,WAAW,CAEEa,cAAc,GAAG,OAAO;AAFrCb,WAAW,C;mBAAXA,WAAW,EAAA4B,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,mBAAA;AAAA;AAAX/B,WAAW,C;SAAXA,WAAW;EAAAgC,OAAA,EAAXhC,WAAW,CAAAiC,IAAA;EAAAC,UAAA,EAFV;AAAM"},"metadata":{},"sourceType":"module","externalDependencies":[]}