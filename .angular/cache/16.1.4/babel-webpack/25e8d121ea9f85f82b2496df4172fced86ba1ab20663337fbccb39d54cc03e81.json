{"ast":null,"code":"import { Todo } from '../models/todo.model';\nimport { BehaviorSubject } from 'rxjs';\nimport { Filter } from '../models/filter.model';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./local-storage.service\";\nexport class TodoService {\n  updateTodosData() {\n    this.displayTodosSubject.next(this.filterTodos);\n    this.lengthSubject.next(this.todos.length);\n  }\n  constructor(storageService) {\n    this.storageService = storageService;\n    this.lengthSubject = new BehaviorSubject(0);\n    this.displayTodosSubject = new BehaviorSubject([]);\n    this.currentFilter = Filter.All;\n    // todo$ = displayTodosSubject\n    this.todo$ = this.displayTodosSubject.asObservable();\n    // length$ = lengthSubject\n    this.length$ = this.lengthSubject.asObservable();\n  }\n  // Lấy tất cả todo từ LocalStorage\n  fetchFromLocalStorage() {\n    this.todos = this.storageService.getValue(TodoService.TodoStorageKey) || [];\n    console.log(this.todos);\n    this.filterTodos = [...this.todos];\n    this.updateTodosData();\n  }\n  // Update data\n  updateToLocalStorage() {\n    this.storageService.setObject(TodoService.TodoStorageKey, this.todos);\n    this.filterTodo(this.currentFilter, false);\n    this.updateTodosData();\n  }\n  // Add data\n  addTodo(content) {\n    const date = new Date(Date.now()).getTime();\n    const newTodo = new Todo(date, content);\n    this.todos.push(newTodo);\n    this.updateToLocalStorage();\n  }\n  editTodo(id, content) {\n    const index = this.todos.findIndex(t => t.id === id);\n    const todo = this.todos[index];\n    todo.content = content;\n    this.todos.splice(index, 1, todo);\n    this.updateToLocalStorage();\n  }\n  deleteTodo(id) {\n    const index = this.todos.findIndex(t => t.id === id);\n    this.todos.splice(index, 1);\n    this.updateToLocalStorage();\n  }\n  // Thay đổi trang thái \n  changeTodoStatus(id, isCompleted) {\n    const index = this.todos.findIndex(t => t.id === id);\n    const todo = this.todos[index];\n    todo.isCompleted = isCompleted;\n    // Thay đổi index thành todo mới\n    this.todos.splice(index, 1, todo);\n    this.updateToLocalStorage();\n  }\n  toggleAll() {\n    this.todos = this.todos.map(todo => {\n      return {\n        ...todo,\n        isCompleted: !this.todos.every(t => t.isCompleted)\n      };\n    });\n    this.updateToLocalStorage();\n  }\n  filterTodo(filter, isFiltering = true) {\n    this.currentFilter = filter;\n    switch (filter) {\n      // Với todo.isCompleted = fasle\n      case Filter.Active:\n        this.filterTodos = this.todos.filter(todo => !todo.isCompleted);\n        break;\n      // Với todo.isCompleted = true\n      case Filter.Completed:\n        this.filterTodos = this.todos.filter(todo => todo.isCompleted);\n        break;\n      // Với tất cả các todo\n      case Filter.All:\n        // this.filterTodos = [...this.todos.map(todo => ({...todo}) )];\n        this.filterTodos = [...this.todos];\n        break;\n    }\n    if (isFiltering) {\n      this.updateTodosData();\n    }\n  }\n  clearCompleted() {\n    this.todos = this.todos.filter(todo => !todo.isCompleted);\n    this.updateToLocalStorage();\n  }\n}\n// Lấy ra các key trong LocalStorage\n// Được sử dụng để lưu trữ tên key để truy cập dữ liệu \"to-do\" trong localStorage\nTodoService.TodoStorageKey = \"todos\";\nTodoService.ɵfac = function TodoService_Factory(t) {\n  return new (t || TodoService)(i0.ɵɵinject(i1.LocalStorageService));\n};\nTodoService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: TodoService,\n  factory: TodoService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"names":["Todo","BehaviorSubject","Filter","TodoService","updateTodosData","displayTodosSubject","next","filterTodos","lengthSubject","todos","length","constructor","storageService","currentFilter","All","todo$","asObservable","length$","fetchFromLocalStorage","getValue","TodoStorageKey","console","log","updateToLocalStorage","setObject","filterTodo","addTodo","content","date","Date","now","getTime","newTodo","push","editTodo","id","index","findIndex","t","todo","splice","deleteTodo","changeTodoStatus","isCompleted","toggleAll","map","every","filter","isFiltering","Active","Completed","clearCompleted","i0","ɵɵinject","i1","LocalStorageService","factory","ɵfac","providedIn"],"sources":["D:\\Data\\TTS_Angular\\ToDoApp\\angular_todoapp\\src\\app\\services\\todo.service.ts"],"sourcesContent":["import { Injectable, OnInit } from '@angular/core';\nimport { Todo } from '../models/todo.model';\nimport { BehaviorSubject, Observable, ObservableLike } from 'rxjs';\nimport { Filter } from '../models/filter.model';\nimport { LocalStorageService } from './local-storage.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class TodoService{\n\n  // Lấy ra các key trong LocalStorage\n  // Được sử dụng để lưu trữ tên key để truy cập dữ liệu \"to-do\" trong localStorage\n  private static readonly TodoStorageKey = \"todos\";\n\n  private todos!: Todo[];\n  private filterTodos!: Todo[];\n  private lengthSubject: BehaviorSubject<number> = new BehaviorSubject<number>(0);\n  private displayTodosSubject: BehaviorSubject<Todo[]> = new BehaviorSubject<Todo[]>([]);\n  private currentFilter: Filter = Filter.All;\n\n  private updateTodosData(){\n    this.displayTodosSubject.next(this.filterTodos);\n    this.lengthSubject.next(this.todos.length);\n  }\n\n  // todo$ = displayTodosSubject\n  todo$: Observable<Todo[]> = this.displayTodosSubject.asObservable();\n  // length$ = lengthSubject\n  length$: Observable<number> = this.lengthSubject.asObservable();\n\n  constructor(private storageService: LocalStorageService) {  }\n\n  // Lấy tất cả todo từ LocalStorage\n  fetchFromLocalStorage(){\n    this.todos = this.storageService.getValue<Todo[]>(TodoService.TodoStorageKey) || [];\n    console.log(this.todos);\n    \n    this.filterTodos = [...this.todos];\n    this.updateTodosData();\n  }\n\n  // Update data\n  updateToLocalStorage(){\n    this.storageService.setObject(TodoService.TodoStorageKey, this.todos);\n    this.filterTodo(this.currentFilter, false);\n    this.updateTodosData();\n  }\n\n  // Add data\n  addTodo(content: string){\n    const date = new Date(Date.now()).getTime();\n    const newTodo = new Todo(date, content);\n    this.todos.push(newTodo);\n    this.updateToLocalStorage();\n  }\n\n  editTodo(id: number, content: string){\n    const index = this.todos.findIndex(t => t.id === id);\n    const todo = this.todos[index];\n    todo.content = content;\n    this.todos.splice(index, 1, todo);\n    this.updateToLocalStorage();\n  }\n\n  deleteTodo(id: number){\n    const index = this.todos.findIndex(t => t.id === id);\n    this.todos.splice(index, 1);\n    this.updateToLocalStorage();\n  }\n\n\n  // Thay đổi trang thái \n  changeTodoStatus(id: number, isCompleted: boolean){\n    const index = this.todos.findIndex(t => t.id === id);\n    const todo = this.todos[index];\n    todo.isCompleted = isCompleted;\n    // Thay đổi index thành todo mới\n    this.todos.splice(index, 1, todo);\n    this.updateToLocalStorage();\n  }\n\n  toggleAll(){\n    this.todos = this.todos.map(todo =>{\n      return {\n        ...todo,\n        isCompleted: !this.todos.every(t => t.isCompleted)\n      }\n    });\n    this.updateToLocalStorage();\n  }\n\n  filterTodo(filter: Filter, isFiltering: boolean = true){\n    this.currentFilter = filter;\n    switch(filter){\n      // Với todo.isCompleted = fasle\n      case Filter.Active:\n        this.filterTodos = this.todos.filter(todo => !todo.isCompleted);\n        break;\n      // Với todo.isCompleted = true\n      case Filter.Completed:\n        this.filterTodos = this.todos.filter(todo => todo.isCompleted);\n        break;\n      // Với tất cả các todo\n      case Filter.All:\n        // this.filterTodos = [...this.todos.map(todo => ({...todo}) )];\n        this.filterTodos = [...this.todos];\n        break;\n    }\n\n    if(isFiltering){\n      this.updateTodosData();\n    }\n  }\n\n  clearCompleted(){\n    this.todos = this.todos.filter(todo => !todo.isCompleted);\n    this.updateToLocalStorage();\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}